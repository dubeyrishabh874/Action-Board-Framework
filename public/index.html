<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico?v=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Web app using React + TypeScript" />

    <!-- Force no cache -->
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <link rel="manifest" href="%PUBLIC_URL%/manifest.json?v=1" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png?v=1" />

    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <title>ACTION BOARD</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- Auto-reload on broken JS load (Uncaught SyntaxError from cached bundle) -->
    <script>
      window.addEventListener("error", function (e) {
        const isBrokenJS = e?.message?.includes("Unexpected token '<'");
        if (isBrokenJS) {
          if ("caches" in window) {
            caches.keys().then((keys) => {
              Promise.all(keys.map((key) => caches.delete(key))).then(() => {
                window.location.reload(true);
              });
            });
          } else {
            window.location.reload(true);
          }
        }
      });
    </script>

    <!-- Optional: Retry manifest load for broken deployments -->
    <script>
      fetch("/manifest.json?v=1").catch(() => {
        console.warn("Manifest load failed. Attempting reload...");
        setTimeout(() => location.reload(), 1000);
      });
    </script>
  </body>
</html>
